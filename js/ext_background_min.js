$(document).ready(function (a) { getCurrentCondition(); setInterval(function () { getCurrentCondition() }, 3600000) }); function getCurrentCondition() { if ($.cookie("wext_city_info") == undefined) { return } if ($.cookie("wext_city_info") != undefined) { var a = new Array(); a = JSON.parse($.cookie("wext_city_info")); if (a.length <= 0) { return } } $.cookie("wext_city_info", JSON.stringify(a), { expires: 365, path: "/" }); wextCityInfo = a[0]; var d = 0; if ($.cookie("wext_is_metrics") != undefined) { d = parseInt($.cookie("wext_is_metrics")) } $.cookie("wext_is_metrics", d, { expires: 365, path: "/" }); var b = "http://api.openweathermap.org/data/2.5/weather?id=" + wextCityInfo.id + "&units=imperial&APPID=cafbb1492a57d00ca4e67dd502f780fd&mode=json"; var c = typeof XMLHttpRequest != "undefined" ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP"); c.open("GET", b, true); c.onreadystatechange = function () { if (c.readyState == 4 && c.status == 200) { var g = JSON.parse(c.responseText); $.cookie("wext_current_weather", c.responseText, { expires: 365 }); var e; if (d == 1) { var f = Math.round((Math.round(g.main.temp) - 32) * (5 / 9)); e = f + " C" } else { e = Math.round(g.main.temp) + " F" } chrome.browserAction.setBadgeText({ text: e }); chrome.browserAction.setBadgeBackgroundColor({ color: "#000000" }); chrome.browserAction.setTitle({ title: wextCityInfo.Name }); getForecastData(wextCityInfo.id) } }; c.send() } function getForecastData(c) { var a = "http://api.openweathermap.org/data/2.5/forecast/daily?mode=json&APPID=cafbb1492a57d00ca4e67dd502f780fd&units=imperial&cnt=7&id=" + c; var b = typeof XMLHttpRequest != "undefined" ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP"); b.open("GET", a, true); b.onreadystatechange = function () { if (b.readyState == 4 && b.status == 200) { var d = JSON.parse(b.responseText); $.cookie("wext_forecast_weather", b.responseText, { expires: 365 }) } }; b.send() };
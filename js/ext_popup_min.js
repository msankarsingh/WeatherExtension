var wext_month = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]; $(document).ready(function (c) { c("#wext_location_finder").hide(); c("#wext_main_div").hide(); c("#wext_location_setting_div").hide(); var a = 1; if (c.cookie("wext_city_info") == undefined) { a = 0 } if (c.cookie("wext_city_info") != undefined) { var b = new Array(); b = JSON.parse(c.cookie("wext_city_info")); if (b.length <= 0) { a = 0 } } c("#wxt_location_search_btn").off("click"); c("#wxt_location_search_btn").on("click", function (g) { var f = c.trim(c("#wxt_location_search").val()); if (f == "") { http: c("#wxt_location_search").css("border", "1px solid red") } else { c("#wxt_location_search").css("border", "1px solid #000000"); wextSearchLocation() } }); c("#wxt_location_search").off("keypress"); c("#wxt_location_search").on("keypress", function (g) { c("#wxt_location_search").css("border", "1px solid #000000"); if (g.which == 13) { var f = c.trim(c("#wxt_location_search").val()); if (f == "") { c("#wxt_location_search").css("border", "1px solid red") } else { c("#wxt_location_search").css("border", "1px solid #000000"); wextSearchLocation() } } }); c("#wxt_location_search").off("focus"); c("#wxt_location_search").on("focus", function (f) { c("#wxt_location_search").css("border", "1px solid #000000") }); c("#wxt_cel").off("click"); c("#wxt_cel").on("click", function (f) { c.cookie("wext_is_metrics", 1, { expires: 365, path: "/" }); if (a == 1) { wextPopulateCurrentCondition(); wextPopulateTodayCondition(); wextPopulateRecentLocationList(); c("#wext_location_finder").hide(); c("#wext_main_div").show(); c("#wext_location_setting_div").hide() } }); c("#wxt_f").off("click"); c("#wxt_f").on("click", function (f) { c.cookie("wext_is_metrics", 0, { expires: 365, path: "/" }); if (a == 1) { wextPopulateCurrentCondition(); wextPopulateTodayCondition(); wextPopulateRecentLocationList(); c("#wext_location_finder").hide(); c("#wext_main_div").show(); c("#wext_location_setting_div").hide() } }); c("#wext_setting_icon").off("click"); c("#wext_setting_icon").on("click", function (f) { c("#wext_location_finder").hide(); c("#wext_main_div").hide(); c("#wext_location_setting_div").show() }); c("#wext_close_setting").off("click"); c("#wext_close_setting").on("click", function (f) { if (a == 1) { c("#wext_location_finder").hide(); c("#wext_main_div").show(); c("#wext_location_setting_div").hide() } else { c("#wext_location_finder").show(); c("#wext_main_div").hide(); c("#wext_location_setting_div").hide() } }); var d = 0; if (c.cookie("wext_is_metrics") != undefined) { d = parseInt(c.cookie("wext_is_metrics")) } if (d == 1) { c("#wxt_cel").attr("checked", "checked") } else { c("#wxt_f").attr("checked", "checked") } if (a == 0) { c("#wext_location_finder").show(); c("#wext_main_div").hide(); c("#wext_location_setting_div").hide(); c("#wext_setting_span").off("click"); c("#wext_setting_span").on("click", function (f) { c("#wext_location_finder").hide(); c("#wext_main_div").hide(); c("#wext_location_setting_div").show() }); c("#wext_user_current_loc").off("click"); c("#wext_user_current_loc").on("click", function (f) { if (geoPosition.init()) { geoPosition.getCurrentPosition(wextShowPosition, geoError) } }); return } c("#wext_main_div").show(); wextPopulateLocInfo(); wextPopulateCurrentCondition(); wextPopulateTodayCondition(); wextPopulateRecentLocationList() }); function geoError() { alert("Could not find you!") } function wextShowPosition(a) { var d = 0; if ($.cookie("wext_is_metrics") != undefined) { d = parseInt($.cookie("wext_is_metrics")) } $.cookie("wext_is_metrics", d, { expires: 365, path: "/" }); var b = "http://api.openweathermap.org/data/2.5/weather?lat=" + a.coords.latitude + "&lon=" + a.coords.longitude + "&units=imperial&APPID=cafbb1492a57d00ca4e67dd502f780fd&mode=json"; var c = typeof XMLHttpRequest != "undefined" ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP"); c.open("GET", b, true); c.onreadystatechange = function () { if (c.readyState == 4 && c.status == 200) { var e = JSON.parse(c.responseText); getNewWextDetails(e.id, e.name + "," + e.sys.country) } }; c.send() } function wextPopulateRecentLocationList() { if ($.cookie("wext_city_info") == undefined) { return } $("#wext_recent_location_div").html(""); var a = JSON.parse($.cookie("wext_city_info")); $.each(a, function (b, c) { $("<p>", { text: c.Name, id: "wext_loc_rlp" + c.id, data_city_id: c.id, data_city_name: c.Name }).appendTo("#wext_recent_location_div").off("click").on("click", function () { getNewWextDetails(c.id, c.Name) }) }) } function wextSearchLocation() { $("#wext_location_div").html(""); $("<p>", { html: "<b>Searching location.Please wait...</b>" }).appendTo("#wext_location_div"); var a = "http://api.openweathermap.org/data/2.1/find/name?APPID=8fd4a36fef708d9028d84b150a600e49&type=like&sort=population&q=" + $.trim($("#wxt_location_search").val()); var b = typeof XMLHttpRequest != "undefined" ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP"); b.open("GET", a, true); b.onreadystatechange = function () { $("#wext_location_div").html(""); if (b.readyState == 4 && b.status == 200) { var c = JSON.parse(b.responseText); if (c != undefined && c.list != undefined) { $.each(c.list, function (d, e) { $("<p>", { text: e.name + "," + e.sys.country, id: "wext_loc_p" + e.id, data_city_id: e.id, data_city_name: e.name + "," + e.sys.country }).appendTo("#wext_location_div").off("click").on("click", function () { getNewWextDetails(e.id, e.name + "," + e.sys.country) }) }) } else { $("#wext_location_div").html(""); $("<p>", { html: "<b>Location not found.</b>" }).appendTo("#wext_location_div") } $("#wxt_location_search").val("") } else { $("#wext_location_div").html(""); $("<p>", { html: "<b>Sorry something went wrong. Please try again.</b>" }).appendTo("#wext_location_div"); $("#wxt_location_search").val("") } }; b.send() } function getNewWextDetails(c, e) { var a = { id: c, Name: e }; var d = new Array(); d.push(a); if ($.cookie("wext_city_info") != undefined) { var b = JSON.parse($.cookie("wext_city_info")); $.each(b, function (f, g) { if (f < 4) { if (g.id != c) { d.push(g) } } }) } $.cookie("wext_city_info", JSON.stringify(d), { expires: 365, path: "/" }); $("#wext_location_div").html(""); getCurrentCondition(c); chrome.browserAction.setBadgeBackgroundColor({ color: "#000000" }); chrome.browserAction.setTitle({ title: a.Name }) } function getCurrentCondition(d) { $("#wext_main_body").block({ message: '<span style="font-size:20px;font-family: lucida grande,tahoma,verdana,arial,sans-serif;">Please Wait...</span></h1>' }); var c = 0; if ($.cookie("wext_is_metrics") != undefined) { c = parseInt($.cookie("wext_is_metrics")) } $.cookie("wext_is_metrics", c, { expires: 365, path: "/" }); var a = "http://api.openweathermap.org/data/2.5/weather?id=" + d + "&units=imperial&APPID=8fd4a36fef708d9028d84b150a600e49&mode=json"; var b = typeof XMLHttpRequest != "undefined" ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP"); b.open("GET", a, true); b.onreadystatechange = function () { if (b.readyState == 4 && b.status == 200) { var g = JSON.parse(b.responseText); $.cookie("wext_current_weather", b.responseText, { expires: 365 }); var e; if (c == 1) { var f = Math.round((Math.round(g.main.temp) - 32) * (5 / 9)); e = f + " C" } else { e = Math.round(g.main.temp) + " F" } chrome.browserAction.setBadgeText({ text: e }); getForecastData(d) } }; b.send() } function getForecastData(c) { var a = "http://api.openweathermap.org/data/2.5/forecast/daily?mode=json&APPID=8fd4a36fef708d9028d84b150a600e49&units=imperial&cnt=7&id=" + c; var b = typeof XMLHttpRequest != "undefined" ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP"); b.open("GET", a, true); b.onreadystatechange = function () { if (b.readyState == 4 && b.status == 200) { var d = JSON.parse(b.responseText); $.cookie("wext_forecast_weather", b.responseText, { expires: 365 }); $("#wext_main_body").unblock(); wextPopulateLocInfo(); wextPopulateCurrentCondition(); wextPopulateTodayCondition(); wextPopulateRecentLocationList(); $("#wext_location_finder").hide(); $("#wext_main_div").show(); $("#wext_location_setting_div").hide() } }; b.send() } function wextPopulateTodayCondition() { if ($.cookie("wext_forecast_weather") == undefined) { return } var f = JSON.parse($.cookie("wext_forecast_weather")); for (var i = 0; i < f.list.length; i++) { var b = f.list[i]; $("#wext_today_title_" + i).html(""); var k = new Date(b.dt * 1000); var a = wext_month[k.getMonth()] + " " + k.getDate(); $("#wext_today_title_" + i).html(a); b.weather[0].icon = b.weather[0].icon.replace(/d+/, "d"); b.weather[0].icon = b.weather[0].icon.replace(/n+/, "n"); $("#wext_today_icon_" + i).html(""); var c = $("<img>").attr("src", "image/weather_icon/" + b.weather[0].icon + ".svg"); c.appendTo("#wext_today_icon_" + i); $("#wext_today_text_" + i).html(""); $("#wext_today_text_" + i).html("<br/>" + toTitleCase(b.weather[0].description)); var e = 0; if ($.cookie("wext_is_metrics") != undefined) { e = parseInt($.cookie("wext_is_metrics")) } else { e = 0 } if (e == 1) { var h = Math.round((Math.round(b.temp.max) - 32) * (5 / 9)); var d = Math.round((Math.round(b.temp.min) - 32) * (5 / 9)); $("#wext_today_temp_" + i).html(h + " &#176C<br/> " + d + " &#176C") } else { var j = Math.round(b.temp.max); var g = Math.round(b.temp.min); $("#wext_today_temp_" + i).html(j + " &#176F<br/> " + g + " &#176F") } } } function wextPopulateCurrentCondition() { if ($.cookie("wext_current_weather") == undefined) { return } var c = JSON.parse($.cookie("wext_current_weather")); $("#wext_now_icon").html(""); var a = $("<img>").attr("src", "image/weather_icon/" + c.weather[0].icon + ".svg"); a.appendTo("#wext_now_icon"); $("#wext_now_text").html(""); $("#wext_now_text").html("<br/>" + toTitleCase(c.weather[0].description)); var d = 0; if ($.cookie("wext_is_metrics") != undefined) { d = parseInt($.cookie("wext_is_metrics")) } else { d = 0 } $("#wext_now_temp").html(""); if (d == 1) { var b = Math.round((Math.round(c.main.temp) - 32) * (5 / 9)); $("#wext_now_temp").html(b + " &#176C"); chrome.browserAction.setBadgeText({ text: b + " C" }) } else { $("#wext_now_temp").html(Math.round(c.main.temp) + " &#176F"); chrome.browserAction.setBadgeText({ text: Math.round(c.main.temp) + " F" }) } } function wextPopulateLocInfo() { if ($.cookie("wext_city_info") == undefined) { return } var a = JSON.parse($.cookie("wext_city_info")); if (a.length <= 0) { return } $("#wext_loc_info_span").html(a[0].Name) } function toTitleCase(a) { return a.replace(/(?:^|\s)\w/g, function (b) { return b.toUpperCase() }) } function getLocalTimeFromGMT(a) { var b = new Date(a); b.setTime(b.getTime() - b.getTimezoneOffset() * 60 * 1000); alert(b.toLocaleString()) };